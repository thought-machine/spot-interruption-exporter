name: Create and publish a Docker image
# Configures this workflow to run every time a change is pushed to the branch called `release`.
on:
  push:
    branches: ['master']
env:
  IMAGE_NAME: ${{ github.repository }}

# There is a single job in this workflow. It's configured to run on the latest available version of Ubuntu.
jobs:
  build-and-push-image:
    runs-on: ubuntu-latest
    # Sets the permissions granted to the `GITHUB_TOKEN` for the actions in this job.
    permissions:
      contents: read
      packages: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Log in to the Container registry
        run: echo $GITHUB_TOKEN | docker login ghcr.io -u ${USERNAME} --password-stdin
        env:
          USERNAME: ${{ github.actor }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: Build and Push docker image
        run: |
          docker build . -t $IMAGE_NAME:${GITHUB_SHA}
          docker push $IMAGE_NAME:${GITHUB_SHA}
